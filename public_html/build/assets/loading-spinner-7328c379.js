class o{constructor(){this.overlay=null,this.isVisible=!1,this.hideTimeout=null,this.minDisplayTime=2e3,this.showStartTime=null,this.isBlocked=!1,this.blockTimeout=null,this.init()}init(){document.addEventListener("DOMContentLoaded",()=>{this.overlay=document.getElementById("globalLoadingSpinner"),this.setupEventListeners(),this.bindToNavigationAndForms()})}setupEventListeners(){document.addEventListener("click",t=>{if(this.isBlocked||this.isModalEvent(t)||document.body.classList.contains("modal-active"))return;const e=t.target.closest("a[href]");e&&this.shouldShowSpinnerForLink(e)&&this.show("Переход")}),window.addEventListener("popstate",()=>{this.show("Загрузка")})}bindToNavigationAndForms(){document.querySelectorAll(".mb-nav-link").forEach(i=>{i.addEventListener("click",()=>{this.show("Загрузка")})}),document.querySelectorAll(".sidebar .nav-link").forEach(i=>{i.addEventListener("click",()=>{this.show("Переход")})}),document.querySelectorAll("form").forEach(i=>{i.addEventListener("submit",r=>{this.shouldShowSpinnerForForm(i)&&this.show("Обработка")})})}shouldShowSpinnerForLink(t){if(this.isBlocked)return!1;const e=t.getAttribute("href");if(!e||e.startsWith("#")||e.includes("javascript:void(0)")||e==="#"||t.classList.contains("no-spinner")||t.closest(".no-spinner")||t.closest('[data-modal="true"]')||t.closest(".modal-trigger"))return!1;const s=t.parentElement;return!(s&&(s.hasAttribute("data-modal")||s.hasAttribute("data-modal-target")||s.classList.contains("modal-trigger"))||e.includes("http")&&!e.includes(window.location.hostname)||t.getAttribute("target")==="_blank"||document.body.classList.contains("modal-active"))}shouldShowSpinnerForForm(t){return!(t.classList.contains("no-spinner")||t.classList.contains("ajax-form"))}show(t="Загрузка"){if(!this.isVisible&&(this.isVisible=!0,this.showStartTime=Date.now(),this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=null),this.overlay)){const e=this.overlay.querySelector(".loading-text");e&&(e.innerHTML=`${t}<span class="loading-dots">...</span>`),this.overlay.classList.add("show"),document.body.style.overflow="hidden",navigator.vibrate&&navigator.vibrate(30)}}hide(){if(!this.isVisible)return;const t=Date.now()-(this.showStartTime||0),e=Math.max(0,this.minDisplayTime-t);e>0?this.hideTimeout=setTimeout(()=>{this.performHide()},e):this.performHide()}performHide(){this.isVisible=!1,this.showStartTime=null,this.overlay&&(this.overlay.classList.remove("show"),setTimeout(()=>{document.body.style.overflow=""},1500)),this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=null)}showWithText(t){this.show(t)}showFor(t,e="Загрузка"){this.show(e),setTimeout(()=>{this.hide()},t)}blockShowTemporarily(t=1e3){this.isBlocked=!0,this.blockTimeout&&clearTimeout(this.blockTimeout),this.blockTimeout=setTimeout(()=>{this.isBlocked=!1},t)}forceHide(){this.blockShowTemporarily(500),this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=null),this.performHide()}isModalEvent(t){if(document.body.classList.contains("modal-active"))return!0;const e=t.target;return!!(e.closest('[data-modal="true"]')||e.closest(".modal-trigger")||e.closest(".modal-panel")||e.closest(".mb-popup-container")||e.closest(".no-spinner"))}}window.loadingSpinner=new o;
